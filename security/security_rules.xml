<?xml version="1.0" encoding="utf-8" ?>
<odoo>

    <data noupdate="0">

        <record id="rule_student_see_classmates" model="ir.rule">
            <field name="name">Sinh viên: Xem bản thân và bạn cùng lớp</field>
            <field name="model_id" ref="model_school_student"/>
            <field name="groups" eval="[(4, ref('group_school_student'))]"/>
            <field name="domain_force">
                ['|', ('user_id', '=', user.id), ('class_id', 'in', user.student_ids.class_id.ids)]
            </field>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record id="rule_student_own_grades" model="ir.rule">
            <field name="name">Sinh viên: Xem điểm cá nhân và cùng lớp</field>
            <field name="model_id" ref="model_school_grade"/>
            <field name="domain_force">
                ['|', ('student_id.user_id', '=', user.id), ('student_id.class_id', 'in', user.student_ids.mapped('class_id').ids)]
            </field>
            <field name="groups" eval="[(4, ref('group_school_student'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record id="rule_student_manage_enrollment" model="ir.rule">
            <field name="name">Sinh viên: Quản lý đăng ký môn học cá nhân</field>
            <field name="model_id" ref="model_school_enrollment"/>
            <field name="domain_force">[('student_id.user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_school_student'))]"/>
        </record>

        <record id="rule_teacher_own_profile" model="ir.rule">
            <field name="name">Giảng viên: Chỉ xem hồ sơ cá nhân</field>
            <field name="model_id" ref="model_school_teacher"/>
            <field name="domain_force">[('user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_school_teacher'))]"/>
        </record>

        <record id="rule_teacher_advised_classes" model="ir.rule">
            <field name="name">Giảng viên: Xem lớp phụ trách</field>
            <field name="model_id" ref="model_school_class"/>
            <field name="domain_force">[('advisor_id.user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_school_teacher'))]"/>
        </record>

        <record id="rule_teacher_manage_grades" model="ir.rule">
            <field name="name">Giảng viên: Quản lý điểm lớp phụ trách</field>
            <field name="model_id" ref="model_school_grade"/>
            <field name="domain_force">[('student_id.class_id.advisor_id.user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_school_teacher'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>
    </data>
</odoo>